#!/usr/bin/env node

const fs   = require('fs');
const cwd  = require('cwd');
const log  = require('verbalize');
const argv = require('minimist')(process.argv.slice(2));


// normalize-pkg
var pkg  = require('../');

// Set the `runner` for verbalize
log.runner = 'normalize-pkg';


// Run with verbose logging
log.mode.verbose = argv.v || argv.verbose || false;


/**
 * Args
 */

var src  = argv._[0] || argv.s || argv.src  || 'package.json',
    dest = argv._[1] || argv.d || argv.dest || 'package.json';


/**
 * Start
 */

log.writeln();
log.bold('  ' + log.runner, 'reading package.json');

// Normalize package.json
var normalizePkg = function(filepath) {
  var obj = require(cwd(filepath));
  obj = pkg.normalizeAuthor(obj);
  obj = pkg.normalizeLicense(obj);
  obj = pkg.normalizeRepo(obj);
  obj = pkg.normalizeBugs(obj);
  obj = pkg.normalizeKeywords(obj);
  return JSON.stringify(obj, null, 2);
};

// Write the file
fs.writeFileSync(cwd(dest), normalizePkg(src));

/**
 * Log a success message.
 */

log.writeln();
log.success('  ' + log.runner + ' [done]');